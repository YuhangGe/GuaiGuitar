GuaiGuitar
==========

小乖看谱，一个全新的吉他谱阅览和编辑APP！

期待对吉他和音乐有兴趣的程序员加入这个项目！
====

目标
------
1. 定义吉他谱（包括六线谱，简谱和歌词）的简单数据存储格式，用可以理解的txt文本，使用JSON格式。
2. 编写吉他谱渲染引擎。渲染时自动动态布局。分页后可以定义节拍速度，自动翻页。
3. 编写吉他谱编辑工具，可以高效快速地编辑吉他谱。
4. 以上2，3点可以合为一个APP。初期编写IOS的APP，然后扩展为HTML5格式可以在任何地方浏览。
5. 之后编写Android和WindowsPhone版本的APP。这一点期待其它程序员加入！
6. 在IOS和HTML5写好之后，进一步改进吉他谱格式，以支持历史更改记录，构建吉他谱共享wiki社区。期望这个社区可以在吉他（以及音乐爱好者）的努力下，逐步形成一个海量乐谱分享的网站。因为网站保存的是可视化的txt/xml格式，吉他谱查看时是由引擎渲染，所以不会出现像现在网上的图片版本的吉他谱质量参差不齐。并且利用wiki社区的wiki思想，希望能提供更为丰富的资源。社区不应该有广告，如果可能，使用捐献模式。
* 编写吉他谱图像识别软件，可以将图片的吉他谱转换为我们定义的格式，或者部分转换然后利用编辑器快速修改完成。（这个目标难度比较大，需要学习计算机图像识别的相关知识，期待有相关能力和兴趣的同学加入！）
* 进一步的，可以将吉他谱扩展为五线谱，使得可以有更多的人（比如学钢琴的人）可以使用这个社区。

吉他谱数据格式
====
版本：1.0.0  
初始制定：[Yuhang Ge(小葛)](http://xiaoge.me)   
参与修改：[Yuhang Ge(小葛)](http://xiaoge.me)，（期待更多人加入！）

格式
---
````json
{
	title : '约定',
	keywords : ['约定','王菲','爱情'],
	info : {
		lyrics : '林夕',
		composer : '林夕',
		singer : '王菲'
	},
	meter : {
		beat : '4/4'
		time : 2000,
	},
	clef : 'c+',  // maybe 'c+','c-','c','e','d+' etc. 
	chrods : [{
		name : 'C',
		start : 1,
		hide_detail : false,
		silence : [6], //哪些弦是静音弦（和弦上表示为叉叉X）
		empty : [1, 5], //哪些弦是空弦（和弦上不标示或标示为圆圈O）
		frets : [{
			type : 'cross',
			value : '6>1|1',
		}, {
			type : 'finger',
			value : ['3.3', '4.2']
		}, ...] 
	}, {
		name : 'A',
		start : ,
		... : ...
	}],
	bars : [{
		render : {
			//... 如果这里有render项，则说明是特殊的覆盖了默认的值。
		},
		chord_track : [{
			name : 'A',
			position :  'p30',
		}, {
			name : 'C',
			position : 'b1'
		}],
		string_track : [{
			value : ['r', 'r_0a_', 'xe_xd_', '(xaxb)_xd__xc__']
		}, {
			value : ['xf_xd_', '(xbxc)_xd__xc__', 'xa', 'xf__[2d__4d__]^[SL]xc']
		}, {
			value : ['wd>a', '-', 'wd>a', '-']
		}, {
			value : ['wd>a', '-', 'wd>a_sd>a_', 'sd>a'],
			connect : ['c0.0>c2.1']
		}, {
			value : ['(2c0e)_b_', '{wa>c}(0a1b2c)_1b_']
		}, {
			value : ['[(7|1a7|1f)_7|1b._8|2c__]^3']
		}, {
			value : ['2a__4a__5a__4a__'],
			connect : ['c0.0>0.1^(H.O)', 'c0.1>c0.2^(H.O)', 'c0.2>c0.3^(H.O)', 'c0.3>c0.4^(H.O)']
		}],
		score_track : [{
			value : ['0_', '3+__', '3+__']
		}, {
			value : ['{1+__}2+_', '1+__', '3+__'],
			connect : ['c2.0>n0.0']
		}, {
			value : ['{#}3+__', '{b}3+__']
		}, {
			value : ['3', '-']
		}, {
			value : ['6+', '-', '-', '[5+_6+_5+_]^[3]']
		}, {
			value : ['4.', '3_', '[3__4__]3_', '{p7}2_1_']
		}],
		word_track_0 : [{
			value : '董小姐',
			position : 'b2'
		}, {
			value : '你从没',
			position : 'p81'
		}],
		word_track_1 : [{

		}],
		word_track_2 : [{

		}],
		...
	}, {

	}, {

	}, ...],

	render : {
		bar_padding_left : 5,
		bar_padding_right : 5,
		bar_length : 200
	}

	}
}
````
详细说明
---

* `meter.beat`是节拍号，'4/4'代表4/4拍，也可以是2/4，6/8拍等。
* `meter.time`是一个节拍所用的时间，这个时间会决定在播放时的速度，影响翻页的时间点。（注意这里的播放，前期只是指无声的播放，用户可以看到当前播放位置，从而作为练习时速度的控制。后期版本，如果可以，加入声音效果，就像guitar-pro那样自动播放。）
* `clef`是调号，c+代表升C调，c代表C调，c-代表降C调，以此类推。
* `chrods`是当前乐谱里用到的所有吉他和弦。其中：
	* `name`是和弦名，比如C和弦。
	* `start`是和弦第一品上的数字，如果是1，通常在吉他谱上就不专门标识。
	* `hide_detail`是指是否只显示和弦名字而不具体显示细节。通常简单的和弦大家知道怎么按，就只标识和弦名字。
	* `slience`是指阻止发音的弦的集合，通常在吉他谱和弦里用一个x来表示这个弦不能发音。
	* `empty`是指空弦音的集合。吉他谱里通常用一个o来表示空弦，很多时候也不标识任何符号表示是空弦。
	* `frets`是具体的每一个品格的按法。从0开始，依次代表低品格到高品格。其中:
		* `type`代表当前品格的类型，是普通按指头(finger)，还是横按(cross)。
		* `value`是具体的按法，如果是横按，则记录当前品格从哪弦按到哪弦，用哪个指头按。比如'1>6|1'表示从1弦按到6弦，使用食指。如果是普通的指头按法，则记录了当前品格有哪几根弦被按了，依次用哪个指头。比如['3.3', '4.2']表示第3和第4弦都被按了，分别用了无名指和中指。（1到4分别是食指，中指，无名指，小拇指）
* `bars`代表的是具体的音乐集合，里面每个元素是一个小节。其中chord_track是和弦的那一行，string_track是六线谱的那行，score_track是简谱的那一行，word_track是歌词那一行。分别的说明如下：

	* `chord_track`是当前小节里面和每一个和弦的集合。其中：
		* `name`是和弦的名称，对应于`chrods`集合里面的某个和弦。
		* `position`是和弦的位置，'p30'代表百分比'percent'，30%相对于当前小节。'b1'代表节拍，1节拍相对于当前小节，如果当前是4/4拍，则一共可能有'b0','b1','b2','b3'四种情况（其它拍号类似）。'b'是以节拍来做单位，'p'是以百分比为单位。'p'更灵活，可以把和弦放置在任意位置。在编辑乐谱时，用户横向拖动和弦时，可以吸附式的在'b0'-'b3'的位置里移动，方便用户使用。但有些特殊情况，和弦不在节拍的开始位置，用户可以选择使用百分比任意拖动和弦到想要位置。`position`对于接下来的其它符号，也具有同样的含义。总之，涉及到位置，都以相对于当前小节的节拍来表示。

	* `string_track`是当前小节里六线谱的所有符号的集合。集合里每个元素的value是当前小节的几个拍子。比如4/4拍则每个value有4个元素，2/4拍则每个value有两个元素。每个元素用字符串表示，其中：
		* `r`代表'rest'，是休止符。（六线谱里面不用0来作休止，0只代表空弦。简谱里0代表休止符。）
		* `x`代表六线谱上的一个x，也就是指头拨动的标识。`0`,`7`,`12`一类的数字代表指头拨动哪个品格。'x'或数字后面紧跟着的`a`到`f`，代表六根弦。'xa'代表在第一弦该和弦的品格上拨，'7c'代表在第3弦的第7品格上拨。
		* `|`代表当前是哪个指头。比如'7|1c'代表用食指（第1个指头）拨动第3弦（第c弦）的第7个品格。'|'不是必须的，当出现'|'时，会在当前音下面额外标注指头数字。如果多个音被括号'()'括起来，则下面需要竖列标注所有指头。
		* `w`代表波浪形的扫弦（wave，也就是琵琶音，慢慢地扫弦）。后面紧跟的是从哪根弦扫到哪根，比如'we>a'代表从5弦扫到1弦。
		* `s`和'w'类似，代表普通扫弦（swipe）。后面紧跟的也是从哪根弦扫到哪根。
		* `_`代表音符长度，每多一个'_'代表除2。该符号跟在'r','x','3'等后面，代表音符长度。比如'xa_'代表2分音符，'7c__'代表4分音符。
		* `.`代表延长当前音符半个音长。
		* `()`括号代表当前几个符号在同一个音符竖上，同时拨动。比如(xaxb)_xd__xc__代表一个二分之1拍音符，同时拨动a弦和b弦，一个四分之一拍音符，拨动d弦，一个四分之一拍音符，拨动c弦。加起来正好是一个拍子的音符。
		* `[]`代表当前几个音符上面用连音符盖起来。通常'[]'会成对出现，中间用`^`号连起来，表示连音符上面的文字。比如常见的SL。'^'也可以不出现，表示没有说明文字。注意，使用[]表示连音通常是一个小节里面的音符之间的连音，如果是跨小节的连音符，则是`connect`字段表示，详见下面的描述。
		* `{}`是指在其紧跟的音符左侧有特别的装饰，'{}'的内容本身不占用小节里的音符。在不同的情况下有不同的涵义：
			* `{1}`代表左边有个快速的小滑音，滑音和主音之间用连音符连接，但滑音不点用音符，下面没有竖条。这里的数字代表品格。
			* `{wa>c}`代表左边有个琵琶音的修饰符。从1弦到3弦。
		* `connect` //todo

	* `score_track`是当前小节里简谱和集合。集合里每个元素的value是当前小节的几个拍子。比如4/4拍则每个value有4个元素，2/4拍则每个value有两个元素。每个元素用字符串表示，其中：
		* `1+`数字代表音阶，`+`号和`-`号代表升7度和降7度，也就是上面加一个点或下面加一个点。每多一个+号则多加一个点。
		* `.`和'string_track'六线谱里一致，代表延长。参看上面的描述。
		* `_`和'string_track'六线谱里一致，代表音符长度。参看上面的描述。
		* `[]`和`^`符号和六线谱一致，表示连音符。参看上面的描述。
		* `{}`和'string_track'里面的含义基本一致，包括：
			* `{#}`和`{b}`代表升音和降音。
			* `{1+__}`代表左边有个快速的小滑音，滑音和主音之间用连音符连接，但滑音不点用音符。
			* `{p7}` ? //todo

	* `word_track_0`是当前小节里歌词的集合。歌词集合里的元素和`chord_track`类似，一个小节没有固定的个数：
		* `value`代表具体的歌词。
		* `position`代表歌词的位置，跟`chord_track`里面的'position'一致，参看上面的描述。

	* `render`是当前小节在渲染的是参数，包括长度等。这个是可选项，如果没有，则使用全局的`render`参数。

	* `word_track_1`以及更多，都是歌词栏。一个谱子可以有一栏歌词，也可以没有歌词。可以在某些小节有多栏，某些小节只有一栏。

* `render`是当前谱子的默认渲染参数。当前版本只记录数字，单位统一使用`px`，也就是像素。当前包括：
	* `bar_padding_left`小节内左padding.
	* `bar_padding_right`小节内右padding.
	* `bar_length`小节的宽度。


